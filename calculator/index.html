<html>

<head>
    <meta charset="utf-8">
    <title>年化收益计算器</title>
</head>

<body>
    <h3>输入参数</h3>
    <div>
        本金: <input type="text" id="principal" oninput="checkMoney(this)" />元
        <br />
        投资时长: <input type="text" id="days" oninput="checkDay(this)" />天
        <br />
        年化收益率: <input type="text" id="rate" oninput="checkMoney(this)" />%
        <br />
        实际收益: <input type="text" id="income" oninput="checkMoney(this)" />元
    </div>

    <h3>计算结果</h3>
    <div>
        <input type="button" value="计算所有" onclick="calculateAll()" />
        <br />
        <input type="button" value="计算预期收益" onclick="calculateInterest()" />
        <input type="text" id="interest" readonly="readonly" />元
        <br />
        <input type="button" value="计算实际年化收益率" onclick="calculateRateActual()" />
        <input type="text" id="rate_actual" readonly="readonly" />%
        <br />
        <input type="button" value="计算损失金额" onclick="calculateLoss()" />
        <input type="text" id="loss" readonly="readonly" />元
    </div>

    <h3>说明</h3>
    <div>
        <ul>
            <li>计算公式</li>
            <ul>
                <li>预期收益 = 本金 × 年化收益率 × 投资天数 ÷ 365</li>
                <li>实际年化收益率 = 实际收益 ÷ 本金 ÷ 投资天数 × 365 × 100%</li>
                <li>损耗金额 = 预期收益 - 实际收益</li>
            </ul>
        </ul>
    </div>
</body>

<script type="text/javascript">
    // 参数
    var principal = document.getElementById('principal');
    var days = document.getElementById('days');
    var rate = document.getElementById('rate');
    var income = document.getElementById('income');
    // 结果
    var interest = document.getElementById('interest');
    var rate_actual = document.getElementById('rate_actual');
    var loss = document.getElementById('loss');
    // 保留2位小数
    function format(e) {
        e.value = Math.round(e.value * 100, 10) / 100;
    }
    // 校验日期格式
    function checkDay(e) {
        // 清除"数字"以外的字符
        e.value = e.value.replace(/[^\d]/g, "");
        // 验证第一个字符是非零数字
        e.value = e.value.replace(/^([0.])/g, "");
    }
    // 校验数字格式
    function checkMoney(e) {
        // 清除"数字"和"."以外的字符
        e.value = e.value.replace(/[^\d.]/g, "");
        // 验证第一个字符是非零数字
        e.value = e.value.replace(/^([0.])/g, "");
        // 清除多余的"."
        e.value = e.value.replace(/\.{2,}/g, ".");
        e.value = e.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", ".");
        // 只能输入两个小数
        e.value = e.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, '$1$2.$3');
    }

    function calculateAll() {
        calculateInterest();
        calculateRateActual();
        calculateLoss();
    }

    function calculateInterest() {
        interest.value = principal.value * days.value * rate.value / 365 / 100;
        format(interest);
    }

    function calculateRateActual() {
        if (principal.value == "" || days.value == "") {
            rate_actual.value = 0;
            return;
        }
        rate_actual.value = 100 * 365 * income.value / principal.value / days.value;
        format(rate_actual);
    }

    function calculateLoss() {
        loss.value = interest.value - income.value;
        format(loss);
    }
</script>

</html>